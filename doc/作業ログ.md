# 作業ログ

過去に行った作業内容のメモ。次回同様の作業を行う際の再現性のため。

## 開発環境

**Python 関係**

1. uv のインストール `curl -LsSf https://astral.sh/uv/install.sh | sh`
2. uv 初期化 `uv init`
3. uv でのコード実行テスト `uv run kaggle/src/main.py`
4. ライブラリインストール
   1. `uv add ipykernel`
   2. `uv add numpy`
   3. `uv add pandas`
   4. `uv add scikit-learn`
   5. `uv add pip`

**VSCode 関係**

1. 拡張機能のインストール
   1. black (Python コードフォーマッタ)
   2. prettier (markdown コードフォーマッタ)
   3. Jupyter (Jupyter Notebook サポート)
2. .vscode/settings.json の設定
3. Python インタープリタの選択 (これをしないとエディタ上でエラー表示が出る)
   1. コマンドパレットを開く
   2. 「Python: Select Interpreter」を選択
   3. uv が管理している Python インタープリタを選択

**Kaggle API 関係**

[公式ドキュメント](https://github.com/Kaggle/kaggle-api/blob/main/docs/README.md)

1. Kaggle API のインストール `uv add kaggle`
2. インストール確認 `uv run kaggle --help`
3. API キーの発行（https://www.kaggle.com/settings）、json ファイルをダウンロード
4. ~/.kaggle ディレクトリを作成し、権限を設定 `mkdir -p ~/.kaggle && chmod 700 ~/.kaggle`
5. ダウンロードした json ファイルを ~/.kaggle に配置し、権限を設定 `chmod 600 ~/.kaggle/kaggle.json`
6. Kaggle API を使ってカーネルをメタデータ付きで kaggle/src/ にダウンロード `uv run kaggle kernels pull root5a/nlp-test -p kaggle/src/ -m`
7. Kaggle API を使ってメタデータからコンペ情報を取得、入力データを data / にダウンロード `uv run kaggle competitions download $(grep -ozP '"competition_sources"\s*:\s*\[\s*\K"[^"]+' kaggle/src/kernel-metadata.json | tr -d '"\0') -p kaggle/input/`
8. unzip して展開、zip の削除 `unzip kaggle/input/nlp-getting-started.zip -d kaggle/input/nlp-getting-started && rm kaggle/input/nlp-getting-started.zip`
9. Kaggle API を使ってコンペの Notebook のコードを kaggle/src/ からアップロード `uv run kaggle kernels push -p kaggle/src/`
10. Kaggle API を使ってコンペの提出用ファイルをアップロード `uv run kaggle competitions submit -c $COMPETITION_NAME -f kaggle/output/submission.csv -m "Submit from local"`

## 実装と精度

- **適当 TF-IDF**
  - 特徴:
    - keyword > 前処理せずダミー変数化
    - location > 前処理せずダミー変数化
    - text > TF-IDF でベクトル化
    - 学習時使用したデータは 80% のみ
  - 結果:
    - ローカル > 0.79
    - 本番 > 0.78118
- **改良版 TF-IDF v1**
  - 特徴:
    - keyword > 前処理せずダミー変数化
    - location > pycountry による国名への正規化をしてからダミー変数化
    - text > 改行削除等の正規化、リンクの[LINK_URL] 置換をしてから TF-IDF でベクトル化
    - 学習時使用したデータは 100%
  - 結果:
    - ローカル > 0.79
    - 本番 > 0.55102
- **改良版 TF-IDF v2**
  - 特徴:
    - keyword > 前処理せずダミー変数化
    - location > pycountry による国名への正規化、記号と数値の削除をしてからダミー変数化
    - text > 改行削除等の正規化、リンクを削除してから TF-IDF でベクトル化
    - 学習時使用したデータは 100%
  - 結果:
    - ローカル (シンプル) > 0.79
    - ローカル (クロス) > 0.67
    - 本番 > 0.77903
